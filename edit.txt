import { NextResponse } from 'next/server';
import httpProxy from 'http-proxy';

const proxy = httpProxy.createProxyServer();

export async function POST(request) {
  const url = new URL(request.url);
  const target = 'http://localhost:5500' + url.pathname.replace('/api', '');

  return new Promise((resolve, reject) => {
    proxy.web(
      request,
      { target, changeOrigin: true },
      (err) => {
        if (err) {
          reject(new Error('Proxy error'));
        } else {
          resolve(NextResponse.next());
        }
      }
    );
  });
}

export async function GET(request) {
  const url = new URL(request.url);
  const target = 'http://localhost:5500' + url.pathname.replace('/api', '');

  return new Promise((resolve, reject) => {
    proxy.web(
      request,
      { target, changeOrigin: true },
      (err) => {
        if (err) {
          reject(new Error('Proxy error'));
        } else {
          resolve(NextResponse.next());
        }
      }
    );
  });
}