import * as React from "react";
import { AuthenticationContext } from "../AuthenticationProvider"; // از کانتکست اصلی استفاده کنید
import { Account } from "@toolpad/core/Account";
import Logout from "@mui/icons-material/Logout";
import Login from "@mui/icons-material/Login";
import { useNavigate } from "react-router-dom";

export default function AppBarSignedIn() {
  const { user, updateUser } = React.useContext(AuthenticationContext); // گرفتن مقدار `user` و `updateUser`
  const navigate = useNavigate();

  const authentication = React.useMemo(() => {
    return {
      signIn: () => {
        console.log("signIn", user);
        navigate("/login"); // هدایت به صفحه لاگین
      },
      signOut: () => {
        updateUser(null);
        localStorage.removeItem("user"); // حذف اطلاعات کاربر از LocalStorage
        navigate("/"); // هدایت به صفحه اصلی بعد از خروج
      },
    };
  }, [user, updateUser]);

  return (
    <Account
      localeText={{
        signInLabel: user ? `خوش آمدید ${user.nameFamily}` : "ورود | ثبت‌ نام",
        signOutLabel: "خروج",
      }}
      slotProps={{
        signInButton: {
          color: "inherit",
          startIcon: <Login />,
          sx: { minWidth: "150px", border: "1px solid #ff9800" },
          onClick: authentication.signIn, // هدایت به لاگین
        },
        signOutButton: {
          color: "success",
          startIcon: <Logout />,
          onClick: authentication.signOut, // خروج از سیستم
        },
      }}
    />
  );
}